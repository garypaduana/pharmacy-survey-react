{"version":3,"sources":["serviceWorker.js","index.js","App.js"],"names":["Boolean","window","location","hostname","match","ReactDOM","render","App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","ALL_PASS","NA","props","survey","questions","rules","className","Survey","Algorithm","worker","dep","responses","number","undefined","operation","value","field","eval","criteria","includes","state","rule","dependsOn","filter","matchCriteria","every","errorMessage","messages","this","map","evaluation","evaluateRule","result","key","id","Evaluation","message","React","Component","currentQuestion","history","backHistory","nextEnabled","previousEnabled","onQuestionAnswered","bind","handleSubmit","goNext","goPrevious","resetButtons","milliseconds","Promise","resolve","setTimeout","response","question","find","setState","prevState","cleanDoubleResponses","event","alert","target","name","preventDefault","length","previous","slice","unshift","answer","nextQuestion","nextNumber","entry","RegExp","pattern","test","next","shift","nn","forEach","bh","content","Question","labels","validationError","onSubmit","type","onClick","disabled","JSON","stringify","handleEntry","option","text","handleDatePickerChange","date","handleSingleSelection","handleMultipleSelection","val","index","arr","push","parent","child","others","Object","keys","hasOwnProperty","optionsAlias","children","onChange","e","handleSingleThenMultiple","checked","inputOptions","responseType","questionForPatient","placeholderText","empty","maxDate","Date","isClearable","selected","options","generateChildren","generateInputOptions"],"mappings":"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","file":"static/js/main.7146a1dd.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","import React from 'react';\nimport DatePicker from 'react-datepicker';\nimport questions from './questions-abbreviated.json';\nimport rules from './rules';\n\nimport \"react-datepicker/dist/react-datepicker.css\"\nimport './App.css';\n\nconst ALL_PASS = \"ALL_PASS\";\nconst NA = \"NA\";\n\nfunction App() {\n  const props = {\n    survey: questions,\n    rules: rules\n  };\n\n  return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <Survey {...props}/>\n        </header>\n      </div>\n  );\n}\n\nclass Algorithm extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { };\n  };\n\n  worker = (dep, responses) => {\n    {\n      if (null === responses[dep.number] || undefined === responses[dep.number]) {\n        return false;\n      }\n      else if (dep.operation === \"eval\"){\n        let value = responses[dep.number][dep.field];\n        return eval(value + dep.criteria);\n      }\n      else if (dep.operation === \"anyMatch\") {\n        return dep.criteria.includes(responses[dep.number][dep.field]);\n      }\n      else {\n        return false;\n      }\n    }\n  };\n\n  evaluateRule(rule, responses) {\n    let shouldRuleApply = rule.dependsOn\n        .filter((dep) => dep.matchCriteria)\n        .every((dep) => this.worker(dep, responses));\n\n    if (shouldRuleApply) {\n      let everyRuleSatisfied = rule.dependsOn.every((dep) => this.worker(dep, responses));\n\n      if (everyRuleSatisfied) {\n        return ALL_PASS;\n      }\n      else {\n        return rule.errorMessage;\n      }\n    }\n    else {\n      return NA;\n    }\n  }\n\n  render() {\n    const messages = this.props.rules.map((rule) => {\n      let evaluation = this.evaluateRule(rule, this.props.responses);\n      let result = (<div/>);\n      if (evaluation !== NA && evaluation !== ALL_PASS) {\n        result = (<li key={rule.id}><Evaluation message={evaluation}/></li>);\n      }\n      return result;\n    });\n\n    return (\n        <div>\n          <div className=\"container\">\n            <h2>Evaluation</h2>\n              <ul>{messages}</ul>\n          </div>\n        </div>\n    );\n  }\n}\n\nclass Evaluation extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { };\n  }\n\n  render() {\n    return (\n        <div>{this.props.message}</div>\n    );\n  }\n}\n\nclass Survey extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentQuestion: \"1\",\n      responses: {},\n      history: [],\n      backHistory: [],\n      nextEnabled: true,\n      previousEnabled: true\n    };\n\n    this.onQuestionAnswered = this.onQuestionAnswered.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.goNext = this.goNext.bind(this);\n    this.goPrevious = this.goPrevious.bind(this);\n    this.resetButtons = this.resetButtons.bind(this);\n  }\n\n  sleep(milliseconds) {\n    return new Promise(resolve => setTimeout(resolve, milliseconds))\n  }\n\n  onQuestionAnswered(number, response) {\n    let question = this.props.survey.questions.find(question => question.number === number);\n\n    this.setState((prevState, props) => ({\n      responses: {\n        ...prevState.responses,\n        [number]: response\n      }\n    }));\n\n    this.cleanDoubleResponses(question, response);\n  }\n\n  handleSubmit(event) {\n    alert(\"name: \" + event.target.name + \"; value: \" + event.target.value);\n    event.preventDefault();\n  }\n\n  resetButtons() {\n    this.setState({\n      nextEnabled: true,\n      previousEnabled: true\n    });\n  }\n\n  goPrevious(event) {\n    if (this.state.history.length > 0) {\n      let previous = this.state.history.slice(this.state.history.length - 1, this.state.history.length);\n      if (previous.length === 0) {\n        previous = [\"1\"];\n      }\n      this.setState((prevState, props) => {\n        prevState.backHistory.unshift(prevState.currentQuestion);\n        return {\n          currentQuestion: previous[0],\n          backHistory: prevState.backHistory,\n          history: [...this.state.history.slice(0, this.state.history.length - 1)],\n          nextEnabled: true\n        }\n      });\n    } else {\n      this.setState({\n        previousEnabled: false,\n        nextEnabled: true\n      });\n    }\n  }\n\n  goNext(event) {\n    // Get the object of the current question\n    let question = this.props.survey.questions.find(question => question.number === this.state.currentQuestion);\n\n    // Figure out what the next question is based on the answer to the current question.\n    const answer = this.state.responses[this.state.currentQuestion]\n    let nextQuestion = question.nextNumber.find(entry => new RegExp(entry.pattern).test(answer));\n\n    if (null != nextQuestion) {\n      nextQuestion = nextQuestion.next;\n    }\n\n    if (\"END\" === nextQuestion) {\n      alert(\"You're at the end!\")\n\n    }\n\n    // Only advance to the next question if it exists based on the previous answer.\n    // Add the current question to the stack of history.\n    else if (this.props.survey.questions.find(question => question.number === nextQuestion)) {\n      this.setState((prevState, props) => {\n        prevState.backHistory.shift();\n        return {\n          currentQuestion: nextQuestion,\n          backHistory: prevState.backHistory,\n          history: [...this.state.history, question.number],\n          previousEnabled: true\n        }\n      });\n    } else {\n      this.setState({\n        nextEnabled: false,\n        previousEnabled: true\n      })\n    }\n  }\n\n  /**\n   * If question.nextNumber has mutually exclusive entries, delete the responses for the options that were not selected.\n   */\n  cleanDoubleResponses(question, response) {\n    // If there is the option to select anything then don't worry about it.\n    if (question.nextNumber.find(nn => nn.pattern === \".*\")) {\n      return\n    }\n    question.nextNumber\n        .filter(nn => !(new RegExp(nn.pattern).test(response)))\n        .forEach(nn => {\n          this.setState((prevState, props) => {\n            let responses = prevState.responses;\n            prevState.backHistory.forEach(bh => {\n              delete responses[bh];\n            });\n            return {\n              backHistory: [],\n              responses: responses\n            }\n          });\n        });\n  }\n\n  render() {\n    let question = this.props.survey.questions.find(question => question.number === this.state.currentQuestion);\n    let content = question ? <Question question={question}\n                                       labels={this.props.survey.labels}\n                                       response={this.state.responses[this.state.currentQuestion]}\n                                       onQuestionAnswered={this.onQuestionAnswered}\n                                       validationError={!this.state.nextEnabled}\n                                       resetButtons={this.resetButtons}/> :\n        <p>Question {this.state.currentQuestion} not found!</p>;\n\n    return (\n        <div>\n          <div className=\"container survey\">\n            <div className=\"header\"> Question \"{this.state.currentQuestion}\" of {this.props.survey.questions.length}</div>\n            <form onSubmit={this.handleSubmit}>\n              <div className=\"question\">{content}</div>\n            </form>\n            <button className=\"navigation\"\n                    type=\"submit\"\n                    name=\"button_previous\"\n                    onClick={this.goPrevious}\n                    disabled={!this.state.previousEnabled}>Previous\n            </button>\n            <button className=\"navigation\"\n                    type=\"submit\"\n                    name=\"button_next\"\n                    onClick={this.goNext}\n                    disabled={!this.state.nextEnabled}>Next\n            </button>\n            <br/>\n          </div>\n          <Algorithm responses={this.state.responses} rules={this.props.rules}/>\n          <pre className=\"code\">{JSON.stringify(this.state, null, 2)}</pre>\n        </div>\n    );\n  }\n}\n\nclass Question extends React.Component {\n\n  handleEntry = (option, event) => {\n    let response = this.props.response || {};\n\n    let text = event.target.value;\n    // if the free text length falls to zero, remove the \"other\" value from the response\n    if (text.length === 0) {\n      delete response[option];\n    }\n    else {\n      // otherwise put an object in there\n      response[option] = text;\n    }\n\n    this.props.onQuestionAnswered(this.props.question.number, response);\n    this.props.resetButtons();\n  };\n\n  handleDatePickerChange = date => {\n    this.props.onQuestionAnswered(this.props.question.number, date);\n    this.props.resetButtons();\n  };\n\n  handleSingleSelection = event => {\n    this.props.onQuestionAnswered(this.props.question.number, event.target.name);\n    this.props.resetButtons();\n  };\n\n  handleMultipleSelection = event => {\n    let response = this.props.response || [];\n    if (!response.includes(event.target.name)) {\n      response.push(event.target.name);\n    } else {\n      response = response.filter((val, index, arr) => val !== event.target.name);\n    }\n    this.props.onQuestionAnswered(this.props.question.number, response);\n    this.props.resetButtons();\n  };\n\n  handleSingleThenMultiple(parent, child, event) {\n    let response = this.props.response || {};\n    let others = new RegExp(\"Other.*\").test(child);\n\n    // Top level is mutually exclusive (i.e. radio buttons); reset the response if the top level changes\n    if (!Object.keys(response).includes(parent)) {\n      response = {};\n      response[parent] = {};\n    }\n\n    if (others) {\n      let text = event.target.value;\n      // if the free text length falls to zero, remove the \"other\" value from the response\n      if (text.length === 0) {\n        delete response[parent][child];\n      }\n      else {\n        // otherwise put an object in there\n        response[parent][child] = text;\n      }\n    }\n    else {\n      // if the child already exists, delete it (toggle off)\n      if (response[parent].hasOwnProperty(child)) {\n        delete response[parent][child];\n      } else if (!child) {\n        response[parent] = {};\n      } else {\n        response[parent][child] = null;\n      }\n    }\n\n    this.props.onQuestionAnswered(this.props.question.number, response);\n    this.props.resetButtons();\n  }\n\n  generateChildren(optionsAlias, parent) {\n    let children = <div/>;\n    if (this.props.response && this.props.response.hasOwnProperty(parent)) {\n      children = optionsAlias[parent].map((child) => {\n        let control;\n        if (new RegExp(\"Other.*\").test(child)) {\n          control = (<div className=\"child\">\n            {child} <input type=\"text\"\n                           name={child}\n                           key={parent + \".\" + child}\n                           value={this.props.response[parent][child]}\n                           onChange={(e) =>\n                               this.handleSingleThenMultiple(parent, child, e)}/>\n             <br/>\n             </div>);\n        }\n        else {\n          control = (<div className=\"child\">\n            <input type=\"checkbox\"\n                   name={child}\n                   key={parent + \".\" + child}\n                   checked={this.props.response && this.props.response[parent].hasOwnProperty(child)}\n                   onChange={(e) =>\n                       this.handleSingleThenMultiple(parent, child, e)}/> {child}\n          <br/>\n          </div>);\n        }\n        return control;\n      });\n    }\n    return children;\n  }\n\n  generateInputOptions(validationError) {\n    let inputOptions = <div/>;\n    let responseType = this.props.question.questionForPatient.responseType;\n    if (responseType === \"DATE_PICKER_OPTIONAL\") {\n      inputOptions = (\n          <div className={\"parent \" +  (validationError ? \"validationError\" : \"\")}>\n            <DatePicker className=\"datePicker\"\n                        placeholderText={this.props.labels[responseType].empty}\n                        maxDate={new Date()}\n                        isClearable\n                        selected={this.props.response}\n                        onChange={this.handleDatePickerChange}/>\n          </div>\n      );\n    } else if (responseType === \"SINGLE_SELECTION\") {\n      inputOptions = this.props.question.questionForPatient.options.map((option) =>\n          <div className={\"parent \" +  (validationError ? \"validationError\" : \"\")}>\n            <input type=\"radio\"\n                   name={option}\n                   key={option}\n                   checked={this.props.response === option}\n                   onChange={this.handleSingleSelection}/> {option}\n          </div>\n      );\n    } else if (responseType === \"MULTIPLE_SELECTION\") {\n      inputOptions = this.props.question.questionForPatient.options.map((option) =>\n          <div className={\"parent \" +  (validationError ? \"validationError\" : \"\")}>\n            <input type=\"checkbox\"\n                   name={option}\n                   key={option}\n                   checked={this.props.response && this.props.response.includes(option)}\n                   onChange={this.handleMultipleSelection}/> {option}\n          </div>\n      );\n    } else if (responseType === \"SINGLE_SELECTION_THEN_MULTIPLE_SELECTION\") {\n      const optionsAlias = this.props.question.questionForPatient.options;\n\n      inputOptions = Object.keys(optionsAlias).map((option) =>\n          <div className={\"parent \" +  (validationError ? \"validationError\" : \"\")}>\n            <input type=\"radio\"\n                   name={option}\n                   key={option}\n                   checked={this.props.response && this.props.response.hasOwnProperty(option)}\n                   onChange={(e) =>\n                       this.handleSingleThenMultiple(option, null, e)}/> {option}\n            <br/>\n            {this.generateChildren(optionsAlias, option)}\n          </div>\n      );\n    } else if (responseType === \"ENTRY\") {\n      inputOptions = this.props.question.questionForPatient.options.map((option) =>\n          <div className={\"parent \" +  (validationError ? \"validationError\" : \"\")}>\n            {option} <input type=\"text\"\n                   name={option}\n                   key={option}\n                   value={this.props.response ? (this.props.response[option] || \"\") : \"\"}\n                   onChange={(e) =>\n                       this.handleEntry(option, e)} />\n          </div>\n      );\n    }\n    return <div className=\"inputOptions\">{inputOptions}</div>;\n  }\n\n  render() {\n    return (\n        <div>\n          <div className=\"questionText\">{this.props.question.questionForPatient.question}</div>\n          {this.generateInputOptions(this.props.validationError)}\n        </div>\n    );\n  }\n}\n\nexport default App;\n"],"sourceRoot":""}